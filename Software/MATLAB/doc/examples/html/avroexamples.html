<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="generator" content="MATLAB R2018a"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><title>MATLAB Interface for Apache Avro</title><style type="text/css">
* {margin: 0; padding: 0;}
body {text-align: start; line-height: 17.234001159668px; min-height: 0px; white-space: normal; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-style: normal; font-size: 13.9999990463257px; font-weight: normal; text-decoration: none; white-space: normal; }
h1, h2 {font-weight: normal;}
.content { padding: 30px; }

.S0 { margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S1 { text-align: left; line-height: 26.3999977111816px; min-height: 24px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-size: 22px; white-space: pre-wrap; margin-left: 4px; margin-top: 3px; margin-bottom: 15px; margin-right: 10px;  }
.S2 { min-height: 0px; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S3 { margin-left: 0px; margin-top: 0px; margin-bottom: 20px; margin-right: 0px;  }
.S4 { line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; font-weight: bold; white-space: pre-wrap; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S5 { line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; white-space: pre-wrap; margin-left: 0px; margin-top: -1px; margin-bottom: 0px; margin-right: 0px;  }
.S6 { min-height: 0px; color: rgb(0, 95, 206); margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S7 { text-align: left; line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; white-space: pre-wrap; margin-left: 4px; margin-top: 2px; margin-bottom: 9px; margin-right: 10px;  }
.S8 { font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S9 { text-align: left; line-height: 20.576000213623px; min-height: 20px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-size: 16px; font-weight: bold; white-space: pre-wrap; margin-left: 4px; margin-top: 15px; margin-bottom: 9px; margin-right: 10px;  }
.S10 { font-family: Helvetica, Arial, sans-serif; margin-left: 0px; margin-top: 10px; margin-bottom: 20px; margin-right: 0px;  }
.S11 { text-align: left; line-height: 20.9999980926514px; white-space: pre-wrap; white-space: pre-wrap; margin-left: 55.9999961853027px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S12 { margin-left: 3px; margin-top: 10px; margin-bottom: 10px; margin-right: 3px;  }
.S13 { min-height: 18px; white-space: nowrap; white-space: nowrap; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S14 { min-height: 0px; white-space: pre; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S15 { color: rgb(160, 32, 240); margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S16 { text-align: left; line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; white-space: pre-wrap; margin-left: 4px; margin-top: 10px; margin-bottom: 9px; margin-right: 10px;  }
.S17 { color: rgb(0, 0, 255); margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }

.CodeBlock {margin: 10px 0 10px 0; background-color: #F7F7F7;}
.CodeBlock+.paragraphNode {margin-top: 10px;}
.lineNode {padding-left: 10px; border-left: 1px solid #E9E9E9; border-right: 1px solid #E9E9E9;}
.inlineWrapper:first-child .lineNode,.inlineWrapper.outputs+.inlineWrapper .lineNode {padding-top: 5px; border-top: 1px solid #E9E9E9;}
.inlineWrapper:last-child .lineNode,.inlineWrapper.outputs .lineNode {padding-bottom: 5px; border-bottom: 1px solid #E9E9E9;}
.lineNode .textBox {white-space: pre;}
</style></head><body><div class = "content"><div class = 'SectionBlock containment active'><h1 class = "S1"><span class = "S2"><span class="S0" id="T_642265A4" >MATLAB Interface for Apache Avro</span></span></h1><div class = "S3"><div class = "S4"><span class = "S2"><span class="S0">Table of Contents</span></span></div><div class = "S5"><a href = "#H_2287E363"><span class = "S0"><span class="S0">Datatypes and Schemas<br></span></span></a><a href = "#H_77B6998B"><span class = "S0"><span class="S0">Write an Avro file<br></span></span></a><a href = "#H_F6C71429"><span class = "S0"><span class="S0">Read an Avro file<br></span></span></a><a href = "#H_0DAD9B96"><span class = "S0"><span class="S0">Serialization of MATLAB objects to Avro files<br></span></span></a><a href = "#H_A787E2C9"><span class = "S0"><span class="S0">Deserialization of MATLAB objects from Avro files<br></span></span></a><a href = "#H_3DDBE4B1"><span class = "S0"><span class="S0">Vectorization<br></span></span></a><a href = "#H_B23FFEC0"><span class = "S0"><span class="S0">Appending data<br></span></span></a><a href = "#H_0EDF37EE"><span class = "S0"><span class="S0">Stress testing<br></span></span></a><a href = "#H_0FF610D6"><span class = "S0"><span class="S0">Testing Sync markers<br></span></span></a><a href = "#H_33C0FF08"><span class = "S0"><span class="S0">Inspecting the Schema </span></span></a></div></div><div class = "S7"><span class = "S2"><span class="S0">Here we describe how to use the </span></span><span class = "S2"><span class="S8">avroread</span></span><span class = "S2"><span class="S0"> and </span></span><span class = "S2"><span class="S8">avrowrite</span></span><span class = "S2"><span class="S0"> functions.</span></span></div><div class = "S7"><span class = "S2"><span class="S0">Help is also available from within MATLAB.</span></span></div><h2 class = "S9"><span class = "S2"><span class="S0" id="H_2287E363" >Datatypes and Schemas</span></span></h2><div class = "S7"><span class = "S2"><span class="S0">Avro files use schemas that are defined in JSON, with the following mapping between MATLAB datatypes:</span></span></div><div class = "S7"><span class = "S2"><span class="S0">       MATLAB Type   Avro Type</span></span></div><div class = "S7"><span class = "S2"><span class="S0">       ===========   =========</span></span></div><div class = "S7"><span class = "S2"><span class="S0">       'double'     'double'</span></span></div><div class = "S7"><span class = "S2"><span class="S0">       'logical'    'boolean'</span></span></div><div class = "S7"><span class = "S2"><span class="S0">       'single'     'float'</span></span></div><div class = "S7"><span class = "S2"><span class="S0">       'uint8'      'int'</span></span></div><div class = "S7"><span class = "S2"><span class="S0">       'uint16'     'int'</span></span></div><div class = "S7"><span class = "S2"><span class="S0">       'uint32'     'int'</span></span></div><div class = "S7"><span class = "S2"><span class="S0">       'uint64'     'long'</span></span></div><div class = "S7"><span class = "S2"><span class="S0">       'char'       'string'  </span></span></div><div class = "S7"><span class = "S2"><span class="S0">       'datetime'   'date'</span></span></div><div class = "S7"><span class = "S2"><span class="S0">       'duration'   'timestamp' ( both milli and micro second)</span></span></div><div class = "S7"><span class = "S2"><span class="S0">       'datetime'   'time'      ( both milli and micro second)</span></span></div><div class = "S7"><span class = "S2"><span class="S0">As well as the above we support writing of the following MATLAB datatypes:</span></span></div><ul class = "S10"><li class = "S11"><span class = "S0"><span class="S0">numeric | string arrays</span></span></li><li class = "S11"><span class = "S0"><span class="S0">table</span></span></li><li class = "S11"><span class = "S0"><span class="S0">timetable</span></span></li><li class = "S11"><span class = "S0"><span class="S0">struct</span></span></li><li class = "S11"><span class = "S0"><span class="S0">cell</span></span></li><li class = "S11"><span class = "S0"><span class="S0">custom user defined objects </span></span></li></ul><div class = "S7"><span class = "S2"><span class="S0">In the bottom of the document we see how we can inspect the schema as well.</span></span></div><h2 class = "S9"><span class = "S2"><span class="S0" id="H_77B6998B" >Write an Avro file</span></span></h2><div class = "S7"><span class = "S2"><span class="S0">Writing an array of numbers to file is easy using avrowrite:</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">data = randn(1e5,10);</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">avrowrite(</span><span class="S15">'tmp.avro'</span><span class="S0">, data);</span></span></div></div></div><h2 class = "S9"><span class = "S2"><span class="S0" id="H_F6C71429" >Read an Avro file</span></span></h2><div class = "S7"><span class = "S2"><span class="S0">Similarly we can use avroread to read the values back in:</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">r = avroread(</span><span class="S15">'tmp.avro'</span><span class="S0">);</span></span></div></div></div><div class = "S16"><span class = "S2"><span class="S0">To ensure the values are equal:</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">isequal(data,r)</span></span></div></div></div><h2 class = "S9"><span class = "S2"><span class="S0" id="H_0DAD9B96" >Serialization of MATLAB objects to Avro files</span></span></h2><div class = "S7"><span class = "S2"><span class="S0">Data packed in user defined objects or array of objects can be persisted into Avro files.</span></span></div><div class = "S7"><span class = "S2"><span class="S0">For example:</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">ex = example.user;</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">ex.name = </span><span class="S15">'Arvind'</span><span class="S0">;</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">ex.number = 42;</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">ex.color = </span><span class="S15">'ultraviolet'</span><span class="S0">;</span></span></div></div></div><div class = "S16"><span class = "S2"><span class="S0">To save the object as an Avro file:</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">avrowrite(</span><span class="S15">'example.avro'</span><span class="S0">,ex);   </span></span></div></div></div><h2 class = "S9"><span class = "S2"><span class="S0" id="H_A787E2C9" >Deserialization of MATLAB objects from Avro files</span></span></h2><div class = "S7"><span class = "S2"><span class="S0">The deserialization of MATLAB objects works equally simply.</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">user = avroread(</span><span class="S15">'example.avro'</span><span class="S0">)</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0"></span></span></div></div></div><div class = "S16"><span class = "S2"><span class="S8">user =</span></span></div><div class = "S7"><span class = "S2"><span class="S8">  user with properties:</span></span></div><div class = "S7"><span class = "S2"><span class="S8"></span></span></div><div class = "S7"><span class = "S2"><span class="S8">      name: 'Arvind'</span></span></div><div class = "S7"><span class = "S2"><span class="S8">    number: 42</span></span></div><div class = "S7"><span class = "S2"><span class="S8">     color: 'ultraviolet'</span></span></div><h2 class = "S9"><span class = "S2"><span class="S0" id="H_3DDBE4B1" >Vectorization</span></span></h2><div class = "S7"><span class = "S2"><span class="S0">The serialization support extends to arrays of objects. This allows code to be vectorized.</span></span></div><div class = "S7"><span class = "S2"><span class="S0">For example, let us create an array of a 100 users.</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">n = 100;</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">containerObjs = repmat(example.user, n,1);</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">Populating </span><span class="S15">them with random data:</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0"></span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">names  = cellfun(@(x) char(randi([65 122],15,1))', cell(n,1)',</span><span class="S15">'UniformOutput'</span><span class="S0">,false)';</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">colors = cellfun(@(x) char(randi([65 122],15,1))', cell(n,1)',</span><span class="S15">'UniformOutput'</span><span class="S0">,false)';</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">nums   = num2cell(randi(1024,100,1));</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0"></span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">[containerObjs.name] = deal(names{:});</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">[containerObjs.color] = deal(colors{:});</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">[containerObjs.number] = deal(nums{:});</span></span></div></div></div><div class = "S16"><span class = "S2"><span class="S0">It is possible to save the data file by saving all elements of the array.</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">avrowrite(</span><span class="S15">'sample.avro'</span><span class="S0">, containerObjs);</span></span></div></div></div><div class = "S16"><span class = "S2"><span class="S0">Save a slice of the data</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">avrowrite(</span><span class="S15">'slice.avro'</span><span class="S0">, containerObjs(50:70));</span></span></div></div></div><h2 class = "S9"><span class = "S2"><span class="S0" id="H_B23FFEC0" >Appending data</span></span></h2><div class = "S7"><span class = "S2"><span class="S0">It is possible to append data to existing files. </span></span></div><div class = "S7"><span class = "S2"><span class="S0">For example, using the same array of objects in the previous section, slices of this data can be appended to an avro file</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">avrowrite(</span><span class="S15">'growingfile.avro'</span><span class="S0">,containerObjs(1:100))</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">avrowrite(</span><span class="S15">'growingfile.avro'</span><span class="S0">,containerObjs(101:200),</span><span class="S15">'AppendToFile'</span><span class="S0">,true)</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">avrowrite(</span><span class="S15">'growingfile.avro'</span><span class="S0">,containerObjs(201:300),</span><span class="S15">'AppendToFile'</span><span class="S0">,true)</span></span></div></div></div><h2 class = "S9"><span class = "S2"><span class="S0" id="H_0EDF37EE" >Stress testing</span></span></h2><div class = "S7"><span class = "S2"><span class="S0">There is a file called avrobash that is useful for stress testing the Avro readers and writers with many different datatypes and options. </span></span></div><div class = "S7"><span class = "S2"><span class="S0">To run it create a temporary folder and simply type </span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">avrobash</span></span></div></div></div><div class = "S16"><span class = "S2"><span class="S0">it should run to completion without error.</span></span></div><h2 class = "S9"><span class = "S2"><span class="S0" id="H_0FF610D6" >Testing Sync markers</span></span></h2><div class = "S7"><span class = "S2"><span class="S0">Run the above </span></span><span class = "S2"><span class="S8">avrobash</span></span><span class = "S2"><span class="S0"> and test the ability to seek to any point in the stream.</span></span></div><div class = "S7"><span class = "S2"><span class="S0">Lets seek to an arbitrary position first, it will seek to the next sync marker automatically since we have written the file with sync markers.</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">[data,reader] = avroread(</span><span class="S15">'bash_array_sync_snappy.avro'</span><span class="S0">,</span><span class="S15">'NumRecords'</span><span class="S0">,1,</span><span class="S17">...</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">    </span><span class="S15">'SeekPosition'</span><span class="S0">,1500,</span><span class="S15">'UseSyncToSeek'</span><span class="S0">,false)</span></span></div></div></div><div class = "S16"><span class = "S2"><span class="S0">Note that we have read in row 8 from the original array by seeking to this point.</span></span></div><div class = "S7"><span class = "S2"><span class="S0">Read the next record, to do this we switch the seek position off by setting it &lt; 0</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">reader.read(</span><span class="S15">'SeekPosition'</span><span class="S0">,-1)</span></span></div></div></div><div class = "S16"><span class = "S2"><span class="S0">Now read 2 records, we can set the </span></span><span class = "S2"><span class="S8">NumRecords</span></span><span class = "S2"><span class="S0"> property and call the </span></span><span class = "S2"><span class="S8">read</span></span><span class = "S2"><span class="S0"> method:</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">reader.NumRecords = 2;</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">reader.read</span></span></div></div></div><div class = "S16"><span class = "S2"><span class="S0">or similarly using Property/Value pairs</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">reader.read(</span><span class="S15">'NumRecords'</span><span class="S0">,2)</span></span></div></div></div><div class = "S16"><span class = "S2"><span class="S0"> Capture the sync point, we will go back here later</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">pos = reader.previousSync</span></span></div></div></div><div class = "S16"><span class = "S2"><span class="S0">read some more records</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">reader.read;</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">reader.read;</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">reader.read</span></span></div></div></div><div class = "S16"><span class = "S2"><span class="S0">Seek back to our sync point </span></span><span class = "S2"><span class="S8">pos</span></span><span class = "S2"><span class="S0"> from above</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">reader.read(</span><span class="S15">'SeekPosition'</span><span class="S0">,pos)</span></span></div></div></div><h2 class = "S9"><span class = "S2"><span class="S0" id="H_33C0FF08" >Inspecting the Schema </span></span></h2><div class = "S7"><span class = "S2"><span class="S0">The schema from a stored file can be inspected.</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">reader = avroread;</span></span></div></div><div class = 'inlineWrapper'><div class = "S13 lineNode"><span class = "S14"><span class="S0">reader.getSchema(</span><span class="S15">'growingfile.avro'</span><span class="S0">)</span></span></div></div></div><div class = "S16"><span class = "S2"><span class="S0">The result is a JSON string that describes the schema of the file.</span></span></div><div class = "S7"><span class = "S2"><span class="S8">ans = </span></span></div><div class = "S7"><span class = "S2"><span class="S8">    "{</span></span></div><div class = "S7"><span class = "S2"><span class="S8">       "type" : "record",</span></span></div><div class = "S7"><span class = "S2"><span class="S8">       "name" : "record_name",</span></span></div><div class = "S7"><span class = "S2"><span class="S8">       "fields" : [ {</span></span></div><div class = "S7"><span class = "S2"><span class="S8">         "name" : "name",</span></span></div><div class = "S7"><span class = "S2"><span class="S8">         "type" : "string"</span></span></div><div class = "S7"><span class = "S2"><span class="S8">       }, {</span></span></div><div class = "S7"><span class = "S2"><span class="S8">         "name" : "number",</span></span></div><div class = "S7"><span class = "S2"><span class="S8">         "type" : "double"</span></span></div><div class = "S7"><span class = "S2"><span class="S8">       }, {</span></span></div><div class = "S7"><span class = "S2"><span class="S8">         "name" : "color",</span></span></div><div class = "S7"><span class = "S2"><span class="S8">         "type" : "string"</span></span></div><div class = "S7"><span class = "S2"><span class="S8">       } ]</span></span></div><div class = "S7"><span class = "S2"><span class="S8">     }"</span></span></div></div></div><br><!-- <br>##### SOURCE BEGIN #####<br>%% MATLAB Interface for Apache Avro<br>% Here we describe how to use the |avroread| and |avrowrite| functions.<br>% <br>% Help is also available from within MATLAB and included as part of the Toolbox <br>% install.<br>%% Datatypes and Schemas<br>% Avro files use schemas that are defined in JSON, with the following mapping <br>% between MATLAB datatypes:<br>% <br>%        MATLAB Type   Avro Type<br>% <br>%        ===========   =========<br>% <br>%        'double'     'double'<br>% <br>%        'logical'    'boolean'<br>% <br>%        'single'     'float'<br>% <br>%        'uint8'      'int'<br>% <br>%        'uint16'     'int'<br>% <br>%        'uint32'     'int'<br>% <br>%        'uint64'     'long'<br>% <br>%        'char'       'string'  <br>% <br>%        'datetime'   'date'<br>% <br>%        'duration'   'timestamp' ( both milli and micro second)<br>% <br>%        'datetime'   'time'      ( both milli and micro second)<br>% <br>% As well as the above we support writing of the following MATLAB datatypes:<br>% <br>% * numeric | string arrays<br>% * table<br>% * timetable<br>% * struct<br>% * cell<br>% * custom user defined objects <br>% <br>% In the bottom of the document we see how we can inspect the schema as well.<br>%% Write an Avro file<br>% Writing an array of numbers to file is easy using avrowrite:<br><br>data = randn(1e5,10);<br>avrowrite('tmp.avro', data);<br>%% Read an Avro file<br>% Similarly we can use avroread to read the values back in:<br><br>r = avroread('tmp.avro');<br>%% <br>% To ensure the values are equal:<br><br>isequal(data,r)<br>%% Serialization of MATLAB objects to Avro files<br>% Data packed in user defined objects or array of objects can be persisted into <br>% Avro files.<br>% <br>% For example:<br><br>ex = example.user;<br>ex.name = 'Arvind';<br>ex.number = 42;<br>ex.color = 'ultraviolet';<br>%% <br>% To save the object as an Avro file:<br><br>avrowrite('example.avro',ex);   <br>%% Deserialization of MATLAB objects from Avro files<br>% The deserialization of MATLAB objects works equally simply.<br><br>user = avroread('example.avro')<br><br>%% <br>% |user =|<br>% <br>% |  user with properties:|<br>% <br>% ||<br>% <br>% |      name: 'Arvind'|<br>% <br>% |    number: 42|<br>% <br>% |     color: 'ultraviolet'|<br>%% Vectorization<br>% The serialization support extends to arrays of objects. This allows code to <br>% be vectorized.<br>% <br>% For example, let us create an array of a 100 users.<br><br>n = 100;<br>containerObjs = repmat(example.user, n,1);<br>Populating them with random data:<br><br>names  = cellfun(@(x) char(randi([65 122],15,1))', cell(n,1)','UniformOutput',false)';<br>colors = cellfun(@(x) char(randi([65 122],15,1))', cell(n,1)','UniformOutput',false)';<br>nums   = num2cell(randi(1024,100,1));<br><br>[containerObjs.name] = deal(names{:});<br>[containerObjs.color] = deal(colors{:});<br>[containerObjs.number] = deal(nums{:});<br>%% <br>% It is possible to save the data file by saving all elements of the array.<br><br>avrowrite('sample.avro', containerObjs);<br>%% <br>% Save a slice of the data<br><br>avrowrite('slice.avro', containerObjs(50:70));<br>%% Appending data<br>% It is possible to append data to existing files. <br>% <br>% For example, using the same array of objects in the previous section, slices <br>% of this data can be appended to an avro file<br><br>avrowrite('growingfile.avro',containerObjs(1:100))<br>avrowrite('growingfile.avro',containerObjs(101:200),'AppendToFile',true)<br>avrowrite('growingfile.avro',containerObjs(201:300),'AppendToFile',true)<br>%% Stress testing<br>% There is a file called avrobash that is useful for stress testing the Avro <br>% readers and writers with many different datatypes and options. <br>% <br>% To run it create a temporary folder and simply type <br><br>avrobash<br>%% <br>% it should run to completion without error.<br>%% Testing Sync markers<br>% If you run the above |avrobash| we can test the ability to seek to any point <br>% in the stream.<br>% <br>% Lets seek to an arbitrary position first, it will seek to the next sync <br>% marker automatically since we have written the file with sync markers.<br><br>[data,reader] = avroread('bash_array_sync_snappy.avro','NumRecords',1,...<br>    'SeekPosition',1500,'UseSyncToSeek',false)<br>%% <br>% Note that we have read in row 8 from the original array by seeking to <br>% this point.<br>% <br>% Read the next record, to do this we switch the seek position off by setting <br>% it < 0<br><br>reader.read('SeekPosition',-1)<br>%% <br>% Now read 2 records, we can set the |NumRecords| property and call the <br>% |read| method:<br><br>reader.NumRecords = 2;<br>reader.read<br>%% <br>% or similarly using Property/Value pairs<br><br>reader.read('NumRecords',2)<br>%% <br>%  Capture the sync point, we will go back here later<br><br>pos = reader.previousSync<br>%% <br>% read some more records<br><br>reader.read;<br>reader.read;<br>reader.read<br>%% <br>% Seek back to our sync point |pos| from above<br><br>reader.read('SeekPosition',pos)<br>%% Inspecting the Schema <br>% The schema from a stored file can be inspected.<br><br>reader = avroread;<br>reader.getSchema('growingfile.avro')<br>%% <br>% The result is a JSON string that describes the schema of the file.<br>% <br>% |ans = |<br>% <br>% |    "{|<br>% <br>% |       "type" : "record",|<br>% <br>% |       "name" : "record_name",|<br>% <br>% |       "fields" : [ {|<br>% <br>% |         "name" : "name",|<br>% <br>% |         "type" : "string"|<br>% <br>% |       }, {|<br>% <br>% |         "name" : "number",|<br>% <br>% |         "type" : "double"|<br>% <br>% |       }, {|<br>% <br>% |         "name" : "color",|<br>% <br>% |         "type" : "string"|<br>% <br>% |       } ]|<br>% <br>% |     }"|<br>##### SOURCE END #####<br>--></body></html>
